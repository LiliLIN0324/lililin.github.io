import{r as l,j as e,B as v,i as P,T as A,W as G,k as U,X as z,U as B,l as O,S as C,h as L,m as D,n as F,o as $,p as M,q}from"./vendor-BKxLCQ_t.js";import{m as W}from"./maplibre-Dg0xXImo.js";const K=[{id:1,user:"Citizen 1",text:"This greenland may need some adjustment.",rating:5,avatar:"C"},{id:2,user:"Citizen 2",text:"Too small parking lot.",rating:2,avatar:"C"},{id:3,user:"Professional 1",text:"Facade is too old, need to adjust.",rating:15,avatar:"P"},{id:4,user:"Government",text:"Building is too old. 20years old, need to remodel.",rating:4,avatar:"G"}],V=[],X=[121.4737,31.4004],Z=()=>{const x=l.useRef(null),i=l.useRef(null),o=l.useRef(null),[r,I]=l.useState(["building","street","landuse","waterbodies","lst-heatmap"]),[m,j]=l.useState(!0),[f,Y]=l.useState(K),[R,E]=l.useState(V),[y,w]=l.useState(""),[b,N]=l.useState(!1),[d,k]=l.useState(null),[T,S]=l.useState(!0),[c,_]=l.useState({name:"BUILDING 1",type:"Select a building on map",Age:"-",Height:"-",structure:"-",style:"-"}),p=t=>{I(a=>a.includes(t)?a.filter(s=>s!==t):[...a,t])};l.useEffect(()=>{if(!x.current)return;const t=new W.Map({container:x.current,style:{version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"#ffffffff"}}]},center:X,zoom:15,pitch:45,bearing:-10,preserveDrawingBuffer:!0});return t.on("load",()=>{i.current=t,t.addSource("landuse",{type:"geojson",data:"/data/landuse.geojson"}),t.addLayer({id:"landuse",type:"fill",source:"landuse",layout:{visibility:r.includes("landuse")?"visible":"none"},paint:{"fill-color":["match",["get","type"],"居住用地","#fdae61","工业用地","#d7191c","公园与绿地用地","#1a9641","商务办公用地","#2b83ba","教育科研用地","#abdda4","商业服务用地","#f46d43","行政办公用地","#8073ac","体育与文化用地","#ffff99","医疗卫生用地","#d9ef8b","机场设施用地","#bdbdbd","交通场站用地","#636363","#e5e7eb"],"fill-opacity":.2}}),t.addSource("waterbodies",{type:"geojson",data:"/data/waterbodies.geojson"}),t.addLayer({id:"waterbodies",type:"fill",source:"waterbodies",layout:{visibility:r.includes("waterbodies")?"visible":"none"},paint:{"fill-color":"#59bdffff","fill-opacity":.6}}),t.addSource("street",{type:"geojson",data:"/data/street.geojson"}),t.addLayer({id:"street",type:"fill",source:"street",layout:{visibility:r.includes("street")?"visible":"none"},paint:{"fill-color":["match",["get","Type"],"支路","#f3f4f6","中心城区道路","#e5e7eb","主干道路","#d1d5db","中心城区主要道路","#d1d5db","郊县中心城区主干道路","#d1d5db","快速路","#9ca3af","快速路匝道","#9ca3af","高速","#6b7280","高速公路匝道","#6b7280","公路","#4b5563","#e5e7eb"],"fill-opacity":.8}}),fetch("/data/building.geojson").then(s=>s.json()).then(s=>{s.features.forEach((u,n)=>{u.id=n}),t.addSource("building",{type:"geojson",data:s}),t.addLayer({id:"building-3d",type:"fill-extrusion",source:"building",layout:{visibility:r.includes("building")?"visible":"none"},paint:{"fill-extrusion-color":["match",["get","Function"],"Residence","#fdc086","Office","#8da0cb","Business","#fc8d62","Industry","#e78ac3","Public service","#a6d854","Other","#bdbdbd","#cccccc"],"fill-extrusion-height":["coalesce",["get","Height"],10],"fill-extrusion-base":0,"fill-extrusion-opacity":.9}})}),t.addSource("lst-heatmap",{type:"image",url:"/data/LST_heatmap.png",coordinates:[[120.81495609,31.89777115],[122.26879924,31.89777115],[122.26879924,30.65364428],[120.81495609,30.65364428]]}),t.addLayer({id:"lst-heatmap",type:"raster",source:"lst-heatmap",layout:{visibility:r.includes("lst-heatmap")?"visible":"none"},paint:{"raster-opacity":.3}}),t.addSource("grid",{type:"geojson",data:"/data/grid.geojson"}),t.addLayer({id:"grid-outline",type:"line",source:"grid",layout:{visibility:"visible"},paint:{"line-color":"#9ca3af","line-width":2,"line-dasharray":[2,10]}}),t.on("click","building-3d",s=>{if(!s.features||s.features.length===0)return;const u=s.features[0],n=u.properties;o.current=s.lngLat,k(s.point),_({name:`BUILDING ${u.id}`,type:n.Function??"Unknown",Age:n.Age??"Unknown",Height:`${Number(n.Height??10).toFixed(2)} m`,structure:n.Structure??"Unknown",style:n.Style??"Unknown"}),S(!0)}),t.on("move",()=>{o.current&&i.current&&k(i.current.project(o.current))});let a=null;t.on("mousemove","building-3d",s=>{!s.features||s.features.length===0||(t.getCanvas().style.cursor="pointer",a!==null&&t.setFeatureState({source:"building",id:a},{hover:!1}),a=s.features[0].id,t.setFeatureState({source:"building",id:a},{hover:!0}))}),t.on("mouseleave","building-3d",()=>{t.getCanvas().style.cursor="",a!==null&&t.setFeatureState({source:"building",id:a},{hover:!1}),a=null})}),()=>t.remove()},[]),l.useEffect(()=>{const t=i.current;if(!t||!t.isStyleLoaded())return;["building-3d","landuse","street","waterbodies","lst-heatmap"].forEach(s=>{if(t.getLayer(s)){const u=s==="building-3d"?"building":s,n=r.includes(u);t.setLayoutProperty(s,"visibility",n?"visible":"none")}})},[r]);const H=()=>{const t=i.current;return t?t.getCanvas().toDataURL("image/png"):null},g=async()=>{!y&&f.length===0||(N(!0),setTimeout(()=>{const t=H(),a={id:Date.now(),title:"History",desc:y||"Generated based on urban analysis",img:t??""};E(s=>[a,...s]),w(""),N(!1)},500))};return e.jsxs("div",{className:"flex h-full w-full bg-white overflow-hidden font-sans select-none",children:[e.jsxs("div",{className:"w-[100px] bg-[#8247e5] flex flex-col items-center py-6 z-50 shadow-2xl shrink-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-full border-[3px] border-white/40 flex items-center justify-center mb-10",children:e.jsx("div",{className:"w-6 h-6 rounded-full bg-white shadow-inner"})}),e.jsxs("div",{className:"flex-1 flex flex-col gap-10 items-center text-white/70",children:[e.jsx(h,{icon:e.jsx(v,{size:26}),label:"建筑",active:r.includes("building"),onClick:()=>p("building")}),e.jsx(h,{icon:e.jsx(P,{size:26,className:"rotate-45"}),label:"道路",active:r.includes("street"),onClick:()=>p("street")}),e.jsx(h,{icon:e.jsx(A,{size:26}),label:"土地",active:r.includes("landuse"),onClick:()=>p("landuse")}),e.jsx(h,{icon:e.jsx(G,{size:26}),label:"水体",active:r.includes("waterbodies"),onClick:()=>p("waterbodies")}),e.jsx(h,{icon:e.jsx(U,{size:26}),label:"地表温度",active:r.includes("lst-heatmap"),onClick:()=>p("lst-heatmap")})]})]}),e.jsxs("div",{className:"flex-1 relative flex flex-col overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-16 bg-white/80 backdrop-blur-md z-30 px-10 flex justify-end items-center border-b border-gray-100 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-gray-800 font-bold text-lg tracking-tight",children:"Regeneration Dashboard"}),e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center text-[#8247e5]",children:e.jsx(v,{size:22})})]})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{ref:x,className:"absolute inset-0 z-0 bg-[#e5e7eb]"}),e.jsxs("div",{className:"absolute z-30 pointer-events-none transition-all duration-75",style:{left:d?`${d.x}px`:"50%",top:d?`${d.y}px`:"50%",transform:d?"translate(-16px, -100%)":"translate(-50%, -50%)",display:d?"block":"none"},children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl border border-gray-100 w-56 overflow-hidden pointer-events-auto transition-all duration-300",children:[e.jsxs("div",{className:"bg-[#8247e5] text-white p-3 flex items-center gap-2",children:[e.jsx(v,{size:16}),e.jsx("span",{className:"text-[11px] font-extrabold uppercase tracking-widest",children:c.name})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"text-[11px] text-[#8247e5] font-bold border-b border-purple-50 pb-1",children:c.type}),e.jsxs("div",{className:"text-[11px] text-[#8247e5] font-bold border-b border-purple-50 pb-1",children:[c.Age," | ",c.Height]}),e.jsx("div",{className:"text-[11px] text-[#8247e5] font-bold border-b border-purple-50 pb-1",children:c.structure}),e.jsx("div",{className:"text-[11px] text-[#8247e5] font-bold italic",children:c.style})]})]}),e.jsx("div",{className:"w-12 h-12 border-l-4 border-b-4 border-[#8247e5]/30 ml-4 -mt-2"})]}),T&&e.jsxs("div",{className:"absolute top-24 left-8 z-30 w-[320px] bg-white/95 backdrop-blur-md rounded-[2.5rem] shadow-[0_20px_50px_rgba(0,0,0,0.1)] p-7 border border-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 px-2",children:[e.jsx(z,{size:20,className:"text-gray-300 hover:text-gray-500 cursor-pointer transition-colors",onClick:()=>S(!1)}),e.jsxs("h3",{className:"font-extrabold text-gray-800 text-base",children:["Comments (",f.length,")"]}),e.jsx("div",{className:"w-5"})]}),e.jsx("div",{className:"space-y-4 mb-8 max-h-[400px] overflow-y-auto pr-2 scrollbar-hide",children:f.map(t=>e.jsxs("div",{className:"flex gap-4 p-3.5 rounded-[1.5rem] border border-transparent hover:border-purple-50 hover:bg-purple-50/30 transition-all",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center shrink-0 border-2 border-white shadow-sm",children:t.avatar==="P"?e.jsx(B,{size:22,className:"text-blue-500"}):e.jsx(O,{size:22,className:"text-purple-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"font-extrabold text-[12px] text-gray-800",children:t.user}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{size:12,className:"fill-yellow-400 text-yellow-400"}),e.jsx("span",{className:"text-[10px] font-bold text-gray-400",children:t.rating})]})]}),e.jsx("p",{className:"text-[11px] text-gray-500 mt-1 leading-relaxed font-medium",children:t.text})]})]},t.id))}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{className:"flex-1 bg-gray-50 text-gray-400 py-3.5 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-gray-100 transition-colors",children:"Advanced"}),e.jsx("button",{onClick:g,disabled:b,className:"flex-1 bg-[#8247e5] text-white py-3.5 rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-lg shadow-purple-100 hover:bg-purple-600 transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:b?e.jsx(L,{size:16,className:"animate-spin"}):"Generate"})]})]}),e.jsx("div",{className:"absolute bottom-12 left-1/2 -translate-x-1/2 w-[720px] z-40",children:e.jsxs("div",{className:"bg-purple-100/90 backdrop-blur-xl rounded-full p-2.5 flex items-center gap-4 shadow-2xl border-2 border-white/50",children:[e.jsx("input",{type:"text",value:y,onChange:t=>w(t.target.value),onKeyDown:t=>t.key==="Enter"&&g(),placeholder:"Suggest a transformation for the selected building...",className:"flex-1 bg-transparent px-8 py-3 outline-none text-purple-900 placeholder:text-purple-300 font-bold text-base"}),e.jsxs("button",{onClick:g,disabled:b,className:"bg-[#8247e5] text-white px-12 py-3.5 rounded-full font-black text-sm shadow-xl hover:bg-purple-600 transition-all active:scale-95 flex items-center gap-2",children:[b&&e.jsx(L,{size:18,className:"animate-spin"}),"Enter"]})]})}),e.jsxs("div",{className:"absolute bottom-12 right-12 z-40 flex flex-col items-center gap-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur rounded-full w-2 h-48 relative shadow-inner border border-gray-100 flex items-center justify-center",children:[e.jsx("div",{className:"absolute top-0 w-3 h-[1px] bg-gray-300"}),e.jsx("div",{className:"absolute bottom-0 w-3 h-[1px] bg-gray-300"}),e.jsx("div",{className:"w-8 h-8 bg-[#8247e5] rounded-xl shadow-lg border-2 border-white cursor-pointer absolute",style:{bottom:"20%"}})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:()=>{var t;return(t=i.current)==null?void 0:t.zoomIn()},className:"w-12 h-12 bg-white rounded-xl shadow-lg flex items-center justify-center text-gray-400 hover:text-[#8247e5] transition-all",children:e.jsx(D,{size:24})}),e.jsx("button",{onClick:()=>{var t;return(t=i.current)==null?void 0:t.zoomOut()},className:"w-12 h-12 bg-white rounded-xl shadow-lg flex items-center justify-center text-gray-400 hover:text-[#8247e5] transition-all",children:e.jsx(F,{size:24})})]})]})]})]}),e.jsxs("div",{className:`relative bg-white border-l border-gray-50 transition-all duration-500 flex flex-col z-50 shadow-[-10px_0_30px_rgba(0,0,0,0.02)] ${m?"w-[300px]":"w-0"}`,children:[e.jsx("button",{onClick:()=>j(!m),className:"absolute -left-10 top-1/2 -translate-y-1/2 w-10 h-24 bg-white border border-gray-100 border-r-0 rounded-l-[2rem] flex items-center justify-center shadow-[-5px_0_15px_rgba(0,0,0,0.05)] text-gray-300 hover:text-[#8247e5] transition-colors",children:m?e.jsx($,{size:24}):e.jsx(M,{size:24})}),m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-7 border-b border-gray-50 flex justify-between items-center",children:[e.jsx("h2",{className:"text-[#8247e5] font-black text-sm uppercase tracking-widest",children:"History Log"}),e.jsx(z,{size:18,className:"text-gray-200 cursor-pointer hover:text-gray-400 transition-colors",onClick:()=>j(!1)})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 scrollbar-hide",children:R.map(t=>e.jsxs("div",{className:"group relative rounded-2xl overflow-hidden shadow-md border border-gray-50 cursor-pointer hover:shadow-xl transition-all",children:[e.jsxs("div",{className:"h-32 bg-gray-100 relative",children:[e.jsx("img",{src:t.img,alt:t.title,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"}),e.jsx("div",{className:"absolute inset-0 bg-black/10"})]}),e.jsx("div",{className:"absolute top-3 left-3 bg-black/60 backdrop-blur-sm text-white px-3 py-1 rounded-full text-[10px] font-black",children:t.title}),e.jsx("div",{className:"absolute bottom-3 left-3 right-3 text-white text-[9px] line-clamp-2 opacity-0 group-hover:opacity-100 transition-opacity",children:t.desc}),e.jsx("div",{className:"absolute top-3 right-3 text-yellow-400 drop-shadow-md",children:e.jsx(C,{size:18,className:"fill-yellow-400"})}),e.jsx("div",{className:"absolute inset-0 border-[5px] border-transparent group-hover:border-[#8247e5]/30 rounded-2xl transition-all"})]},t.id))}),e.jsxs("div",{className:"p-7 space-y-4 bg-gray-50/50",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(q,{size:28,className:"text-purple-200 animate-bounce"})}),e.jsx("button",{onClick:g,disabled:b,className:"w-full bg-white text-gray-800 py-4 rounded-2xl font-black text-[11px] uppercase tracking-[0.3em] hover:bg-[#8247e5] hover:text-white transition-all shadow-xl shadow-gray-100/50 border border-gray-100",children:"REGENERATE"})]})]})]}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .maplibregl-canvas { outline: none !important; }
      `})]})},h=({icon:x,label:i,active:o,onClick:r})=>e.jsxs("div",{onClick:r,className:`flex flex-col items-center gap-1.5 group cursor-pointer transition-all ${o?"text-white":"hover:text-white"}`,children:[e.jsx("div",{className:`p-2 rounded-xl transition-all ${o?"bg-white/20 shadow-lg":"group-hover:bg-white/10"}`,children:x}),e.jsx("span",{className:"text-[15px] font-bold [writing-mode:vertical-rl] tracking-[0.2em] leading-tight",children:i})]});export{Z as default};
